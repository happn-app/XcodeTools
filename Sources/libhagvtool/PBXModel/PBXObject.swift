import CoreData
import Foundation



//In object of type PBXAggregateTarget, instantiated w/ class PBXAggregateTarget, with ID 7B8366011DB41866008FC63E, got the following unknown properties: ["buildConfigurationList", "buildPhases", "productName"]
//In object of type PBXCopyFilesBuildPhase, instantiated w/ class PBXCopyFilesBuildPhase, with ID 7B805DF11D3D614900F337B7, got the following unknown properties: ["dstPath", "dstSubfolderSpec", "name"]
//In object of type PBXCopyFilesBuildPhase, instantiated w/ class PBXCopyFilesBuildPhase, with ID 7BAFB8571A20B8250025D3F9, got the following unknown properties: ["dstPath", "dstSubfolderSpec"]
//In object of type PBXCopyFilesBuildPhase, instantiated w/ class PBXCopyFilesBuildPhase, with ID 7BB85A841A20EA9E004104BC, got the following unknown properties: ["dstPath", "dstSubfolderSpec"]
//In object of type PBXCopyFilesBuildPhase, instantiated w/ class PBXCopyFilesBuildPhase, with ID 94A52C271DBA10CF00A8D0AA, got the following unknown properties: ["dstPath", "dstSubfolderSpec", "name"]
//In object of type PBXFileReference, instantiated w/ class PBXFileReference, with ID 52F5A370242B23C5009813B3, got the following unknown properties: ["wrapsLines"]
//In object of type PBXFileReference, instantiated w/ class PBXFileReference, with ID 94D33AED20767AAB001660C7, got the following unknown properties: ["usesTabs"]
//In object of type PBXGroup, instantiated w/ class PBXGroup, with ID 7BD4BE3218117F6300CC9C69, got the following unknown properties: ["indentWidth", "tabWidth", "usesTabs", "wrapsLines"]
//In object of type PBXNativeTarget, instantiated w/ class PBXNativeTarget, with ID 4E7623B7234DBAA00044911B, got the following unknown properties: ["buildPhases", "buildRules", "productName", "productReference", "productType"]
//In object of type PBXNativeTarget, instantiated w/ class PBXNativeTarget, with ID 4EFF34F023439E4B00FD2A6A, got the following unknown properties: ["buildPhases", "buildRules", "productName", "productReference", "productType"]
//In object of type PBXNativeTarget, instantiated w/ class PBXNativeTarget, with ID 52F9099724923A420048FBED, got the following unknown properties: ["buildPhases", "buildRules", "productName", "productReference", "productType"]
//In object of type PBXNativeTarget, instantiated w/ class PBXNativeTarget, with ID 7B0B56B0200CCD9900CF62E7, got the following unknown properties: ["buildPhases", "buildRules", "productName", "productReference", "productType"]
//In object of type PBXNativeTarget, instantiated w/ class PBXNativeTarget, with ID 7B285DD91C806A4200F1EBA7, got the following unknown properties: ["buildPhases", "buildRules", "productName", "productReference", "productType"]
//In object of type PBXNativeTarget, instantiated w/ class PBXNativeTarget, with ID 7B285DEC1C806B1D00F1EBA7, got the following unknown properties: ["buildPhases", "buildRules", "productName", "productReference", "productType"]
//In object of type PBXNativeTarget, instantiated w/ class PBXNativeTarget, with ID 7B9B58B61A3203E000EB327E, got the following unknown properties: ["buildPhases", "buildRules", "productName", "productReference", "productType"]
//In object of type PBXNativeTarget, instantiated w/ class PBXNativeTarget, with ID 7BAB293A200AB297002A487A, got the following unknown properties: ["buildPhases", "buildRules", "packageProductDependencies", "productName", "productReference", "productType"]
//In object of type PBXNativeTarget, instantiated w/ class PBXNativeTarget, with ID 7BAFB8581A20B8250025D3F9, got the following unknown properties: ["buildPhases", "buildRules", "productName", "productReference", "productType"]
//In object of type PBXNativeTarget, instantiated w/ class PBXNativeTarget, with ID 7BB85A851A20EA9E004104BC, got the following unknown properties: ["buildPhases", "buildRules", "productName", "productReference", "productType"]
//In object of type PBXNativeTarget, instantiated w/ class PBXNativeTarget, with ID 7BD21ED21C7F59550083754F, got the following unknown properties: ["buildPhases", "buildRules", "productName", "productReference", "productType"]
//In object of type PBXNativeTarget, instantiated w/ class PBXNativeTarget, with ID 7BD4BE3A18117F6300CC9C69, got the following unknown properties: ["buildPhases", "buildRules", "packageProductDependencies", "productName", "productReference", "productType"]
//In object of type PBXNativeTarget, instantiated w/ class PBXNativeTarget, with ID B15EA7D5247323F3001F7EA3, got the following unknown properties: ["buildPhases", "buildRules", "packageProductDependencies", "productName", "productReference", "productType"]
//In object of type PBXNativeTarget, instantiated w/ class PBXNativeTarget, with ID B1740A3023FC4E88009D9390, got the following unknown properties: ["buildPhases", "buildRules", "packageProductDependencies", "productName", "productReference", "productType"]
//In object of type PBXNativeTarget, instantiated w/ class PBXNativeTarget, with ID E0205E0B24C5E391008EC76A, got the following unknown properties: ["buildPhases", "buildRules", "productName", "productReference", "productType"]
//In object of type PBXNativeTarget, instantiated w/ class PBXNativeTarget, with ID F28D6AB724AA2615003A75F1, got the following unknown properties: ["buildPhases", "buildRules", "productName", "productReference", "productType"]
//In object of type PBXNativeTarget, instantiated w/ class PBXNativeTarget, with ID F2DE8C6B24B5F1C800B803BA, got the following unknown properties: ["buildPhases", "buildRules", "productName", "productReference", "productType"]
//In object of type PBXProject, instantiated w/ class PBXProject, with ID 7BD4BE3318117F6300CC9C69, got the following unknown properties: ["attributes", "developmentRegion", "hasScannedForEncodings", "knownRegions", "mainGroup", "packageReferences", "productRefGroup", "targets"]
//In object of type PBXShellScriptBuildPhase, instantiated w/ class PBXShellScriptBuildPhase, with ID 3DA38887245C7DDC0024156C, got the following unknown properties: ["inputFileListPaths", "inputPaths", "name", "outputFileListPaths", "outputPaths", "shellPath", "shellScript"]
//In object of type PBXShellScriptBuildPhase, instantiated w/ class PBXShellScriptBuildPhase, with ID 3DEF9B3A243DB77C00EF74F2, got the following unknown properties: ["inputFileListPaths", "inputPaths", "name", "outputFileListPaths", "outputPaths", "shellPath", "shellScript"]
//In object of type PBXShellScriptBuildPhase, instantiated w/ class PBXShellScriptBuildPhase, with ID 7B83660A1DB4186D008FC63E, got the following unknown properties: ["inputFileListPaths", "inputPaths", "outputFileListPaths", "outputPaths", "shellPath", "shellScript"]
//In object of type PBXShellScriptBuildPhase, instantiated w/ class PBXShellScriptBuildPhase, with ID 9437B1F524985321008A0A3C, got the following unknown properties: ["inputFileListPaths", "inputPaths", "name", "outputFileListPaths", "outputPaths", "shellPath", "shellScript"]
//In object of type PBXShellScriptBuildPhase, instantiated w/ class PBXShellScriptBuildPhase, with ID 9437B1F624985335008A0A3C, got the following unknown properties: ["inputFileListPaths", "inputPaths", "name", "outputFileListPaths", "outputPaths", "shellPath", "shellScript"]
//In object of type PBXTargetDependency, instantiated w/ class PBXTargetDependency, with ID E9C8699A23C738F90078D095, got the following unknown properties: ["productRef"]
//In object of type PBXTargetDependency, instantiated w/ class PBXTargetDependency, with ID E9C8699E23C7390B0078D095, got the following unknown properties: ["productRef"]
//In object of type XCSwiftPackageProductDependency, instantiated w/ class XCSwiftPackageProductDependency, with ID 2BE67AD924DAA10B00489C07, got the following unknown properties: ["package", "productName"]
//In object of type XCSwiftPackageProductDependency, instantiated w/ class XCSwiftPackageProductDependency, with ID 2BE67ADB24DAA10B00489C07, got the following unknown properties: ["package", "productName"]
//In object of type XCSwiftPackageProductDependency, instantiated w/ class XCSwiftPackageProductDependency, with ID 2BE67ADD24DAA10C00489C07, got the following unknown properties: ["package", "productName"]
//In object of type XCSwiftPackageProductDependency, instantiated w/ class XCSwiftPackageProductDependency, with ID 2BE67ADF24DAA10D00489C07, got the following unknown properties: ["package", "productName"]
//In object of type XCSwiftPackageProductDependency, instantiated w/ class XCSwiftPackageProductDependency, with ID 2BE67AE124DAA10D00489C07, got the following unknown properties: ["package", "productName"]
//In object of type XCSwiftPackageProductDependency, instantiated w/ class XCSwiftPackageProductDependency, with ID B15B26F5247406D40041BB46, got the following unknown properties: ["package", "productName"]
//In object of type XCSwiftPackageProductDependency, instantiated w/ class XCSwiftPackageProductDependency, with ID B15B26F7247406D40041BB46, got the following unknown properties: ["package", "productName"]
//In object of type XCSwiftPackageProductDependency, instantiated w/ class XCSwiftPackageProductDependency, with ID B15B26FA247407300041BB46, got the following unknown properties: ["package", "productName"]
//In object of type XCSwiftPackageProductDependency, instantiated w/ class XCSwiftPackageProductDependency, with ID B15B26FD247407680041BB46, got the following unknown properties: ["package", "productName"]
//In object of type XCSwiftPackageProductDependency, instantiated w/ class XCSwiftPackageProductDependency, with ID B1B8385B24740E8100E370DD, got the following unknown properties: ["package", "productName"]
//In object of type XCSwiftPackageProductDependency, instantiated w/ class XCSwiftPackageProductDependency, with ID B1B8386124740FB500E370DD, got the following unknown properties: ["package", "productName"]
//In object of type XCSwiftPackageProductDependency, instantiated w/ class XCSwiftPackageProductDependency, with ID E930BBE9237C16F50051D6DF, got the following unknown properties: ["productName"]
//In object of type XCSwiftPackageProductDependency, instantiated w/ class XCSwiftPackageProductDependency, with ID E9C8699423C738DE0078D095, got the following unknown properties: ["package", "productName"]
//In object of type XCSwiftPackageProductDependency, instantiated w/ class XCSwiftPackageProductDependency, with ID E9C8699923C738F90078D095, got the following unknown properties: ["package", "productName"]
//In object of type XCSwiftPackageProductDependency, instantiated w/ class XCSwiftPackageProductDependency, with ID E9C8699D23C7390B0078D095, got the following unknown properties: ["package", "productName"]
//In object of type XCVersionGroup, instantiated w/ class XCVersionGroup, with ID 7B118D10203B541A00C015DC, got the following unknown properties: ["children", "currentVersion", "versionGroupType"]
//In object of type XCVersionGroup, instantiated w/ class XCVersionGroup, with ID 7B5A633D1980533300EA9C58, got the following unknown properties: ["children", "currentVersion", "versionGroupType"]
/* Sadly we cannot implement fillValues in an extension because overriding
 * method in extensions is not supported. */
@objc(PBXObject)
public class PBXObject : NSManagedObject {
	
	/* Set to true to allow allocate unknown objects as PBXObjects. */
	static let allowPBXObjectAllocation = false
	
	open class func propertyRenamings() -> [String: String] {
		return [:]
	}
	
	public static func unsafeInstantiate(rawObjects: [String: [String: Any]], id: String, context: NSManagedObjectContext, decodedObjects: inout [String: PBXObject]) throws -> Self {
		if let decodedObject = decodedObjects[id] {
			guard let result = decodedObject as? Self else {
				throw HagvtoolError(message: "Error, expected an object of type \(self), but got something else in the decoded objects dictionary.")
			}
			return result
		}
		
		let rawObject: [String: Any] = try rawObjects.get(id)
		let isa: String = try rawObject.get("isa")
		
		guard let model = context.persistentStoreCoordinator?.managedObjectModel else {
			throw HagvtoolError(message: "Given context does not have a model!")
		}
		guard let entity = model.entitiesByName[isa] ?? (allowPBXObjectAllocation ? model.entitiesByName["PBXObject"] : nil) else {
			throw HagvtoolError(message: "Did not find isa \(isa) in the CoreData model.")
		}
		guard !entity.isAbstract || (allowPBXObjectAllocation && entity.name == "PBXObject") else {
			throw HagvtoolError(message: "Given isa \(isa) is abstract in the CoreData model (entity = \(entity.name ?? "<unknown>")")
		}
		guard entity.topmostSuperentity().name == "PBXObject" else {
			throw HagvtoolError(message: "Given isa \(isa) whose entity is not related to PBXObject! This is an internal logic error.")
		}
		
		/* First let’s see if the object is not already in the graph */
		let fetchRequest = NSFetchRequest<PBXObject>()
		fetchRequest.entity = entity
		fetchRequest.predicate = NSPredicate(format: "%K == %@", #keyPath(PBXObject.id), id)
		let results = try context.fetch(fetchRequest)
		guard results.count <= 1 else {
			throw HagvtoolError(message: "Internal error: got \(results.count) where at most 1 was expected.")
		}
		
		let created: Bool
		let resultObject: PBXObject
		if let r = results.first {resultObject = r;                                              created = false}
		else                     {resultObject = PBXObject(entity: entity, insertInto: context); created = true}
		
		guard let result = resultObject as? Self else {
			if created {context.delete(resultObject)}
			throw HagvtoolError(message: "Error, expected an object of type \(self), but got something else for id \(id).")
		}
		
		do {
			result.setValue(id,  forKey: #keyPath(PBXObject.id))     /* Could be done in fillValues, but would require to give the id  to fillValues… */
			result.setValue(isa, forKey: #keyPath(PBXObject.rawISA)) /* Could be done in fillValues, but would require to give the isa to fillValues… */
			try result.fillValues(rawObject: rawObject, rawObjects: rawObjects, context: context, decodedObjects: &decodedObjects)
			decodedObjects[id] = result
			return result
		} catch {
			if created {
				context.delete(resultObject)
			}
			throw error
		}
	}
	
	open func fillValues(rawObject: [String: Any], rawObjects: [String: [String: Any]], context: NSManagedObjectContext, decodedObjects: inout [String: PBXObject]) throws {
		guard context === managedObjectContext else {
			throw HagvtoolError(message: "Internal error: asked to fill values of an object with a context != than object’s context")
		}
		
		self.rawObject = rawObject
		
		/* Let’s validate we know all the properties in the raw object. */
		let renamings = Self.propertyRenamings()
		let unknownProperties = Set(rawObject.keys).subtracting(entity.propertiesByName.keys.map{ renamings[$0] ?? $0 }).subtracting(["isa"])
		if !unknownProperties.isEmpty {
			NSLog("%@", "Warning: In object of type \(rawISA ?? "<unknown>"), instantiated w/ class \(entity.name ?? "<unknown>"), with ID \(id ?? "<unknown>"), got the following unknown properties: \(unknownProperties.sorted())")
		}
	}
	
}
